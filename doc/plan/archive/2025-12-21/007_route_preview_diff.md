# 007: 实现同步路线预览 (Preview Diff)

## 1. 目标
在真实执行搬运同步之前，允许用户查看源和目标之间的差异，确保同步结果符合预期。

## 2. 功能描述
- **差异扫描**: 遍历映射规则涉及的所有文件，对比源文件与目标文件（基于 Hash 或更新时间）。
- **文件状态**: 标记文件为“新增”、“修改”、“删除”或“冲突”。
- **详情对比**: 支持点击单个文件查看行级 Diff。

## 3. 开发任务分解

### 3.1 后端差异计算逻辑 (Rust)
- [x] **完善 `preview_route_diff` 指令**:
  - 输入：路线 ID。
  - 逻辑：获取映射规则 -> 遍历源目录对应路径 -> 计算目标路径 -> 比较两者。
  - 输出：差异列表 `Vec<{ path: String, status: String, size: u64 }>`。
- [x] **完善 `get_file_diff` 指令**:
  - 输入：源文件路径、目标文件路径。
  - 使用 `similar` crate 生成差异数据。
  - 返回统一的 Diff 格式（如 Unified Diff 或自定义 JSON）。

### 3.2 前端差异浏览器 (DiffViewerModal.vue)
- [x] **文件列表展示**:
  - 使用列表展示所有变更文件及状态图标。
  - 实现状态颜色规范（绿色-新增，橙色-修改，红色-删除）。
- [x] **内容对比视图**:
  - 集成代码对比组件（可使用现有的 `src/components/diff` 下组件）。
  - 支持“并排”和“内联”两种视图切换。
- [x] **与同步操作联动**:
  - 自预览模态框直接触发同步执行或关闭。

### 3.3 国际化
- [x] **补全词条**:
  - `route.diff.title`: "同步预览"
  - `route.diff.exec_sync`: "确认并开始同步"
  - `route.diff.file_list`: "变更文件列表"

## 4. 验收标准
- [x] 点击“Preview Diff”按钮能成功弹出对话框并列出所有预期的文件变更。
- [x] 点击列表中的文件，能正确显示其实际代码差异。
- [x] 列表状态正确（例如新创建的文件显示为 Added）。

## 5. 执行记录
- **开始时间**: 2025-12-21 00:00:00
- **结束时间**: 2025-12-21 00:05:24
