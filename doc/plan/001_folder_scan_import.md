# 文件夹递归扫描与仓库导入功能设计

## 1. 概述
在仓库管理中增加一个根据文件夹检测的功能。用户选择一个文件夹后，系统递归查找所有 git 项目，并以列表形式展示。用户确认后，自动创建仓库并根据路径创建分组层级。

## 2. 用户交互流程 (UI/UX)

### 2.1 入口
- 在“仓库管理”页面的顶部操作栏增加“扫描导入”按钮。
- 图标建议使用文件夹搜索相关图标。

### 2.2 文件夹选择
- 点击按钮后，调用系统原生文件夹选择对话框 (Tauri API)。
- 用户选择目标根目录 (如 `~/Work/project`).

### 2.3 扫描过程
- 系统显示“正在扫描...”的加载状态或模态框。
- 后端异步递归扫描目标目录下所有包含 `.git` 子目录的文件夹。

### 2.4 结果预览与确认
- **显示形式**: 弹出一个模态框或抽屉，展示扫描结果列表。
- **列表内容**:
    - **复选框**: 默认全选，用户可取消勾选不需要导入的项目。
    - **仓库名称**: 默认为文件夹名称。
    - **路径**: 显示相对于根目录的路径 (用于预览分组结构)。
    - **完整路径**: 用于提示。
- **操作**:
    - 底部提供“确认导入”和“取消”按钮。
    - 显示统计信息 (如: 共发现 15 个仓库)。

### 2.5 导入反馈
- 点击确认后，显示进度条或处理状态。
- 完成后提示“成功导入 X 个仓库”，并在主界面刷新仓库列表。

## 3. 后端逻辑设计 (Rust)

### 3.1 扫描命令 (`scan_local_repos`)
- **输入**: `root_path: String`
- **逻辑**:
    - 使用 `walkdir` 或类似库递归遍历 `root_path`。
    - 忽略常见非代码目录 (如 `node_modules`, `target`, `.trash` 等，虽然 `.git`通常不在里面，但优化性能)。
    - 查找包含 `.git` 文件夹的目录。
    - 收集所有符合条件的目录路径。
- **输出**: `Vec<ScannedRepoStruct>`
    - `path`: 绝对路径
    - `name`: 文件夹名
    - `relative_path`: 相对于 `root_path` 的路径 (用于生成分组)

### 3.2 导入命令 (`import_scanned_repos`)
- **输入**: `root_path: String`, `repos: Vec<ScannedRepoStruct>`
- **逻辑**:
    1. **分组处理**:
       - 遍历 `relative_path`，解析出目录层级。
       - 逐层检查数据库中是否存在由于该路径对应的 `repo_groups`。
       - 如果不存在，则创建对应的分组 (Group)，并设置正确的 `parent_id`。
       - 维护一个 `path -> group_id` 的映射缓存，避免重复查询。
    2. **仓库创建**:
       - 检查数据库中是否已存在同路径的仓库 (避免重复导入)。
       - 创建 `repositories` 记录。
       - `group_id`: 指向步骤 1 中对应的分组 ID。
       - `name`: 文件夹名称。
       - `local_path`: 绝对路径。
       - `auth_type`: 默认为 'none' 或尝试读取 git config (可选优化)。

## 4. 数据库模型影响
- **repo_groups**: 现有的 `id`, `parent_id`, `name` 足以支持。
- **repositories**: 现有的 `local_path`, `group_id` 足以支持。

## 5. 开发任务分解
1. **API 定义**: 定义 Tauri Command 接口。
2. **后端实现**:
   - 文件扫描逻辑。
   - 分组递归创建逻辑。
   - 批量写入逻辑。
3. **前端实现**:
   - 增加按键与调用文件选择。
   - 扫描状态展示。
   - 结果列表组件开发。
   - 导入动作对接。
